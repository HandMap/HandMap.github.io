<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>‘Handy’ GestureAPI &#8211; Hand Map</title> <meta name="description" content="I found a fantastic project by Vasu Agrawal that was designed as a Gesture tracking system. I investigate it’s portability for my project"> <meta name="keywords" content="opencv, gestures, api"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="'Handy' GestureAPI"> <meta name="twitter:description" content="I found a fantastic project by Vasu Agrawal that was designed as a Gesture tracking system. I investigate it’s portability for my project"> <meta name="twitter:site" content="@nathangloverAUS"> <meta name="twitter:creator" content="@nathangloverAUS"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="'Handy' GestureAPI"> <meta property="og:description" content="I found a fantastic project by Vasu Agrawal that was designed as a Gesture tracking system. I investigate it’s portability for my project"> <meta property="og:url" content="https://handmap.github.io/handy-gesture-api/"> <meta property="og:site_name" content="Hand Map"> <meta property="og:image" content="https://handmap.github.io/images/halve.png"> <link rel="canonical" href="https://handmap.github.io/handy-gesture-api/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://handmap.github.io/feed.xml" title="Hand Map" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://handmap.github.io/favicon.png" /> <link rel="shortcut icon" href="https://handmap.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://handmap.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://handmap.github.io/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://handmap.github.io" class="logo"><img src="https://handmap.github.io/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">‘Handy’ GestureAPI </h1> <ul class="tags"> <li><a href="https://handmap.github.io/tags#opencv">opencv</a></li> <li><a href="https://handmap.github.io/tags#gestures">gestures</a></li> <li><a href="https://handmap.github.io/tags#api">api</a></li> </ul> <div class="section-line reverse"><a href="https://handmap.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/handy-gesture-api/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/handy-gesture-api/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/handy-gesture-api/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">24 Aug 2016</div> <h2 id="introduction">Introduction</h2> <hr /> <p>Today while researching approaches for quick Hand mapping using contours I came across a fantastic example in the form of a simple API by a young man named <a href="https://github.com/VasuAgrawal/GestureDetection">Vasu Agrawal</a>. Not only was his code a wealth of interesting examples but he also included some fantastic documentation that he kept whilst working on his Gesture tracking project at Carnegie Mellon University.</p> <p>My goal tonight is to utilize his API and explore how he has overcome some of the problems I’ve been faced with when implementing some of my image processing methods from the previous posts.</p> <h2 id="converting-from-opencv2x-to-3x">Converting from OpenCV2.x to 3.x</h2> <hr /> <p>One of the first problems I needed to overcome was relating to the version of OpenCV Vasu had used when working on this project a few years back. I’m targetting OpenCV version 3+ whilst his API was written for OpenCV2.x.</p> <p>The first issue in the code came from Lines 15 and 16 in <code class="highlighter-rouge">GesturesApi.py</code></p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_CAP_PROP_FRAME_WIDTH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraWidth</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_CAP_PROP_FRAME_HEIGHT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraHeight</span><span class="p">)</span>
</code></pre></div> <p>Both cv.CV_CAP_PROP_FRAME_WIDTH and HEIGHT respectively are not valid variables in the new version of OpenCV. To correct this problem I referenced the API docs for the <a href="http://docs.opencv.org/3.1.0/d8/dfe/classcv_1_1VideoCapture.html">VideoCapture.set() function</a> and found that I simply needed to make the following modifications to update support for OpenCV3.x</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraWidth</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraHeight</span><span class="p">)</span>
</code></pre></div> <p>The second and last issue was with the findContours() method in <code class="highlighter-rouge">GesturesApi.py</code> on lines 118 through 120.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholded</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</code></pre></div> <p>Interestingly enough this was an issue I’d already dealt with previously so I knew the fix was to ammend a <code class="highlighter-rouge">_</code> before the <code class="highlighter-rouge">self.contours</code> return variable. This is because in OpenCV2.x findContours() would only return two variables whereas now in <a href="http://docs.opencv.org/3.0-beta/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html?highlight=findcontours#cv2.findContours">OpenCV3.x</a> we are returned the original input image along with the contours and hierarchy</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholded</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span>
                                    <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</code></pre></div> <h2 id="testing-bundled-example">Testing bundled Example</h2> <hr /> <p>After ironing out the bugs from updating, I ran the code and was amazed by the results. Below is an example of what I was able to capture with my webcam facing my flat hand.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-08-24/nathan-hand-base-test.png" alt="Flat Hand Detect" /> <figcaption>Flat Hand Detect</figcaption> </figure> <p>The results were great! but there’s a catch, It only works well in very specific conditions. For example, practically any light throws the entire process out of whack.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-08-24/nathan-hand-poor-test.png" alt="Poor Hand Detect" /> <figcaption>Poor Hand Detect</figcaption> </figure> <p>The final thing I tested was how it handled by Partners hand. She is living with cerebral palsy and more specifically deals with flexion, or abnormal bending at the wrist or of the fingers, due to muscle spasticity on a daily basis. This means her hand won’t always be in a shape that is easily analysed, so I really wanted to know how the current algorithm handle the hand matching.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-08-24/yhana-hand-cp-test.png" alt="Flexion Hand Detect" /> <figcaption>Flexion Hand Detect</figcaption> </figure> <p>The results of the test were very interesting as it looks like the center point of the hand isn’t calculated correctly due to the abrupt direction particular parts of the hand make. I do have the advantage of being able to utilize a small <code class="highlighter-rouge">lego brick style</code> censor that will be placed on the hand during 3D capture. So hopefully I’ll be able to use this as a easy to identify point of reference.</p> <h2 id="conclusion">Conclusion</h2> <hr /> <p>At this stage I’m really happy with the potential this API will offer. Huge thanks to <a href="https://github.com/VasuAgrawal/GestureDetection">Vasu Agrawal</a> again, seriously awesome work. I’m managing my own fork of the code base <a href="https://github.com/HandMap/GestureDetection">here</a> that anyone can contribute to if they want.</p> <p>Plans for next time will be augment my own ideas with the GestureApi core library and also make sure I can use a small <code class="highlighter-rouge">lego-like</code> block as a reference point (haar classification will probably be the way I go).</p> <h3 id="references">References</h3> <hr /> <p>Spastic cerebral palsy - <a href="https://www.cerebralpalsy.org.au/what-is-cerebral-palsy/types-of-cerebral-palsy/spastic-cerebral-palsy/">https://www.cerebralpalsy.org.au/what-is-cerebral-palsy/types-of-cerebral-palsy/spastic-cerebral-palsy/</a></p> <p>GestureDetection API - <a href="https://github.com/VasuAgrawal/GestureDetection">https://github.com/VasuAgrawal/GestureDetection</a></p> <br> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/handy-gesture-api/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/handy-gesture-api/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/handy-gesture-api/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://handmap.github.io/gradients-and-edge-detection/" class="pagination_pager" title="Gradients and Edge Detection ">previous</a> <a href="https://handmap.github.io/video-1-project-overview/" class="pagination_pager" title="Video 1 - Project Overview ">next</a> </nav> </div> </div> <!-- JS --> <script src="https://handmap.github.io/assets/js/main.min.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-71336829-11', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://github.com/HandMap/HandMap.github.io/blob/master/images/project.jpg) center center no-repeat;"> <a href="https://handmap.github.io" class="inactive" target="_blank" rel="nofollow external"> <span> Hand Map Project <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
