<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Colour detection using RGB boundaries &#8211; Hand Map</title> <meta name="description" content="Looking into Object detection based on RGB colour values. I use RGB boundaries are my delimiter to cut down on objects that don’t belong in the scene"> <meta name="keywords" content="opencv, rgb, colour"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Colour detection using RGB boundaries"> <meta name="twitter:description" content="Looking into Object detection based on RGB colour values. I use RGB boundaries are my delimiter to cut down on objects that don’t belong in the scene"> <meta name="twitter:site" content="@nathangloverAUS"> <meta name="twitter:creator" content="@nathangloverAUS"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Colour detection using RGB boundaries"> <meta property="og:description" content="Looking into Object detection based on RGB colour values. I use RGB boundaries are my delimiter to cut down on objects that don’t belong in the scene"> <meta property="og:url" content="https://handmap.github.io/colour-detection-using-rgb-boundaries/"> <meta property="og:site_name" content="Hand Map"> <meta property="og:image" content="https://handmap.github.io/images/halve.png"> <link rel="canonical" href="https://handmap.github.io/colour-detection-using-rgb-boundaries/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://handmap.github.io/feed.xml" title="Hand Map" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://handmap.github.io/favicon.png" /> <link rel="shortcut icon" href="https://handmap.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://handmap.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://handmap.github.io/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://handmap.github.io" class="logo"><img src="https://handmap.github.io/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Colour detection using RGB boundaries </h1> <ul class="tags"> <li><a href="https://handmap.github.io/tags#opencv">opencv</a></li> <li><a href="https://handmap.github.io/tags#rgb">rgb</a></li> <li><a href="https://handmap.github.io/tags#colour">colour</a></li> </ul> <div class="section-line reverse"><a href="https://handmap.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">03 Sep 2016</div> <h2 id="introduction">Introduction</h2> <hr /> <p>This week during my project meeting I picked up one of the sensor units that will be placed on the hand of the patient during the scanning procedure. The small box (seen below) has gone through a couple iterations so its size has and will be differing over the course of this semester.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-09-03/opencv-hand-blocks.png" alt="OpenCV Lego Brick" /> <figcaption>Lego brick sensor</figcaption> </figure> <p>The thing that is unique about it however is the bright colours that are used during the printing of the casing. This distinct attribute of the block will be my focus point this week as I try to come up with a method of detecting the object, without create too much overhead.</p> <h2 id="why-colour">Why Colour?</h2> <hr /> <p>The computational resources required to process the RGB values in an image are considerably lower than most of the other algorithms I’ve been looking at over the last month. This makes it a perfect starting method to quickly single out the block on the hand and lower the search area for my other more computationally expensive algorithms.</p> <p>The other big reason, is something I already mentioned which is that the block colours are very distinct so there will hopefully be a high chance that the largest object detected in a scene will be the block I’m searching for.</p> <h2 id="initial-testing">Initial Testing</h2> <hr /> <p>I used a tutorial by <a href="http://www.pyimagesearch.com/2014/08/04/opencv-python-color-detection/">Adrian Rosebrock</a> to quickly get a rudimentary colour detector setup. The code the tutorial supplied was originally used to detect a blue Pokemon Gameboy cartridge with an output similar to the image below.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-09-03/color_detection_blue_version.jpg" alt="Pokemon Blue Colour Detection" /> <figcaption>Pokemon blue colour detection - Adrian Rosebrock</figcaption> </figure> <p>The code I implemented can be seen below.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c"># Capture frame-by-frame</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">image</span> <span class="o">=</span> <span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c"># define the list of boundaries</span>
    <span class="n">boundaries</span> <span class="o">=</span> <span class="p">[</span>
	<span class="p">([</span><span class="mi">86</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">220</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
    <span class="p">]</span>

    <span class="c"># loop over the boundaries</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span> <span class="ow">in</span> <span class="n">boundaries</span><span class="p">:</span>
        <span class="c"># create NumPy arrays from the boundaries</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"uint8"</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"uint8"</span><span class="p">)</span>

        <span class="c"># find the colors within the specified boundaries and apply</span>
        <span class="c"># the mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>

        <span class="n">imageOut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">image</span><span class="p">,</span> <span class="n">output</span><span class="p">])</span>

    <span class="c"># Display the resulting frame</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s">'RGB'</span><span class="p">,</span><span class="n">imageOut</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">'q'</span><span class="p">):</span>
        <span class="k">break</span>

<span class="c"># When everything done, release the capture</span>
<span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div> <p>The tests for this system worked considerably well for a first attempt on the blue block</p> <figure> <img src="https://handmap.github.io/images/posts/2016-09-03/opencv-blue-block-detect.png" alt="Blue Colour Detection" /> <figcaption>Blue block detection</figcaption> </figure> <p>In fact it worked too well, and it majorly got my hopes up about how easy this method was going to be. Blue is an interesting color because it isn’t really commonly seen in the particular shade I was targeting. Yellow on the other hand turned out to be a very very prominent colour in practically everything. In fact the results from the yellow tests were pretty terrifying.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-09-03/opencv-yellow-block-fail.png" alt="Yellow Colour Detection" /> <figcaption>Yellow block fail</figcaption> </figure> <p>The issue I started to face very quickly was that I had no good way of testing boundaries when I needed to include a new coloured block other than guessing and checking. It might not seem like a big deal, but I knew at some point down the line I would need to look into boundary calibration so I decided to build a little application for this very purpose.</p> <h2 id="boundedrgb">boundedRGB</h2> <hr /> <p><a href="https://github.com/HandMap/boundedRGB">boundedRGB</a> is a simple RGB boundary manipulation tool that allows for real time changes to the RGB bound variables during scroll sldiers.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-09-03/opencv-yellow-block-detect.png" alt="Yellow Colour Detection" /> <figcaption>Yellow block detection with boundedRGB</figcaption> </figure> <p>I took a lot of care to ensure input values are always handled correctly; particularly when dealing with lower bound thresholds that exceed the upper bounded ones. Below is a code snippet with an example of this logic.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code>    <span class="n">thrs1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'lower - red'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>
    <span class="n">thrs2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'lower - green'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>
    <span class="n">thrs3</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'lower - blue'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>
    <span class="n">thrs4</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'upper - red'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>
    <span class="n">thrs5</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'upper - green'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>
    <span class="n">thrs6</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getTrackbarPos</span><span class="p">(</span><span class="s">'upper - blue'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">thrs1</span> <span class="o">&gt;</span> <span class="n">thrs4</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">setTrackbarPos</span><span class="p">(</span><span class="s">'lower - red'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">,</span> <span class="n">thrs4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">thrs2</span> <span class="o">&gt;</span> <span class="n">thrs5</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">setTrackbarPos</span><span class="p">(</span><span class="s">'lower - green'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">,</span> <span class="n">thrs5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">thrs3</span> <span class="o">&gt;</span> <span class="n">thrs6</span><span class="p">):</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">setTrackbarPos</span><span class="p">(</span><span class="s">'lower - blue'</span><span class="p">,</span> <span class="s">'RGB'</span><span class="p">,</span> <span class="n">thrs6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div> <h2 id="summary">Summary</h2> <hr /> <p>Quick one this week, but very productive esspecially now that I have a really good method of quickly implementing new block colours in my code. Something I’ll have to look at in the future is a way to allow end users to setup their own profiles.</p> <h3 id="references">References</h3> <hr /> <p>OpenCV and Python Color Detection - <a href="http://www.pyimagesearch.com/2014/08/04/opencv-python-color-detection/">http://www.pyimagesearch.com/2014/08/04/opencv-python-color-detection/</a></p> <p>boundedRGB - <a href="https://github.com/HandMap/boundedRGB">https://github.com/HandMap/boundedRGB</a></p> <br> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/colour-detection-using-rgb-boundaries/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://handmap.github.io/video-1-project-overview/" class="pagination_pager" title="Video 1 - Project Overview ">previous</a> <a href="https://handmap.github.io/object-tracking-by-colour/" class="pagination_pager" title="Object tracking by colour ">next</a> </nav> </div> </div> <!-- JS --> <script src="https://handmap.github.io/assets/js/main.min.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-71336829-11', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://github.com/HandMap/HandMap.github.io/blob/master/images/project.jpg) center center no-repeat;"> <a href="https://handmap.github.io" class="inactive" target="_blank" rel="nofollow external"> <span> Hand Map Project <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
