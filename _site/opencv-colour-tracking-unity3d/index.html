<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>OpenCV colour tracking in Unity3D &#8211; Hand Map</title> <meta name="description" content="Curiosity got the better of me and I decided I wanted to make sure I could easily build a small application with OpenCV that would deploy onto an Android/iOS mobile device"> <meta name="keywords" content="opencv, android, ios, unity3d"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="OpenCV colour tracking in Unity3D"> <meta name="twitter:description" content="Curiosity got the better of me and I decided I wanted to make sure I could easily build a small application with OpenCV that would deploy onto an Android/iOS mobile device"> <meta name="twitter:site" content="@nathangloverAUS"> <meta name="twitter:creator" content="@nathangloverAUS"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="OpenCV colour tracking in Unity3D"> <meta property="og:description" content="Curiosity got the better of me and I decided I wanted to make sure I could easily build a small application with OpenCV that would deploy onto an Android/iOS mobile device"> <meta property="og:url" content="https://handmap.github.io/opencv-colour-tracking-unity3d/"> <meta property="og:site_name" content="Hand Map"> <meta property="og:image" content="https://handmap.github.io/images/halve.png"> <link rel="canonical" href="https://handmap.github.io/opencv-colour-tracking-unity3d/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://handmap.github.io/feed.xml" title="Hand Map" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://handmap.github.io/favicon.png" /> <link rel="shortcut icon" href="https://handmap.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://handmap.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://handmap.github.io/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://handmap.github.io" class="logo"><img src="https://handmap.github.io/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">OpenCV colour tracking in Unity3D </h1> <ul class="tags"> <li><a href="https://handmap.github.io/tags#opencv">opencv</a></li> <li><a href="https://handmap.github.io/tags#android">android</a></li> <li><a href="https://handmap.github.io/tags#ios">ios</a></li> <li><a href="https://handmap.github.io/tags#unity3d">unity3d</a></li> </ul> <div class="section-line reverse"><a href="https://handmap.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">14 Mar 2017</div> <h2 id="introduction">Introduction</h2> <hr /> <p>All the work up to this point has been written in a way that makes it fairly easy to port to different platforms. However I realise that I haven’t properly tested whether or not I can get OpenCV working on the mobile platform.</p> <p>This week I decided to see if I could get something up and running with OpenCV in Unity3D, and then deploy it to my Android device. This way I could tell whether I am being realistic with the scope of my project, and also whether or not mobile smartphones can iterate and process live camera video fast enough and without any latency.</p> <h2 id="opencv-for-unity3d">OpenCV for Unity3D</h2> <hr /> <p>There’s bads news and some less bad news… The bad news is that OpenCV as a platform, is just as difficult to get working on mobile as it is PC/Mac. The less bad news is that there is a <a href="https://www.assetstore.unity3d.com/en/#!/content/21088">paid package</a> for OpenCV integration that I picked up a while ago on sale and abstracts out all the terrible integration difficulties while I’m just testing performance (Yay!)</p> <p>I want to stress that this isn’t a permanent decision by me, and I only really want to use this package to test that the OpenCV libraries don’t overload my mobile device too badly.</p> <h3 id="colour-tracking-example">Colour tracking example</h3> <hr /> <p>There’s a neat demo that came packaged along side the OpenCV package for Unity3D that handles multiple object detection based on colour. The example can be tweeked to show how the device will handle a number of different thresholds including</p> <p>MAX_NUMBER_OBJECTS:</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="c1">/// &lt;summary&gt;
/// max number of objects to be detected in frame
/// &lt;/summary&gt;
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_NUM_OBJECTS</span> <span class="p">=</span> <span class="m">50</span><span class="p">;</span>
</code></pre></div> <p>MIN_OBJECT_AREA:</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="c1">/// &lt;summary&gt;
/// minimum and maximum object area
/// &lt;/summary&gt;
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_OBJECT_AREA</span> <span class="p">=</span> <span class="m">20</span> <span class="p">*</span> <span class="m">20</span><span class="p">;</span>
</code></pre></div> <p>It defines a number of different colour thresholds using a ColourObject helper class</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="n">ColorObject</span> <span class="n">blue</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ColorObject</span> <span class="p">(</span><span class="s">"blue"</span><span class="p">);</span>
<span class="n">ColorObject</span> <span class="n">yellow</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ColorObject</span> <span class="p">(</span><span class="s">"yellow"</span><span class="p">);</span>
<span class="n">ColorObject</span> <span class="n">red</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ColorObject</span> <span class="p">(</span><span class="s">"red"</span><span class="p">);</span>
<span class="n">ColorObject</span> <span class="n">green</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ColorObject</span> <span class="p">(</span><span class="s">"green"</span><span class="p">);</span>
</code></pre></div> <p>The helper class simply takes the colour string and returns a ColorObject object containing some relevant details</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">type</span><span class="p">;</span>
<span class="n">Scalar</span> <span class="n">HSVmin</span><span class="p">,</span> <span class="n">HSVmax</span><span class="p">;</span>
<span class="n">Scalar</span> <span class="n">Color</span><span class="p">;</span>
</code></pre></div> <p>The colours themselves are defined within the ColourObject constructor in a simple switch statement</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">"blue"</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//TODO: use "calibration mode" to find HSV min
</span>    <span class="c1">//and HSV max values
</span>
    <span class="nf">setHSVmin</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">92</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
    <span class="nf">setHSVmax</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">124</span><span class="p">,</span> <span class="m">256</span><span class="p">,</span> <span class="m">256</span><span class="p">));</span>

    <span class="c1">//BGR value for Green:
</span>    <span class="nf">setColor</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">255</span><span class="p">));</span>

<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">"green"</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//TODO: use "calibration mode" to find HSV min
</span>    <span class="c1">//and HSV max values
</span>
    <span class="nf">setHSVmin</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">34</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">));</span>
    <span class="nf">setHSVmax</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">80</span><span class="p">,</span> <span class="m">220</span><span class="p">,</span> <span class="m">200</span><span class="p">));</span>

    <span class="c1">//BGR value for Yellow:
</span>    <span class="nf">setColor</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>

<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">"yellow"</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//TODO: use "calibration mode" to find HSV min
</span>    <span class="c1">//and HSV max values
</span>
    <span class="nf">setHSVmin</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">20</span><span class="p">,</span> <span class="m">124</span><span class="p">,</span> <span class="m">123</span><span class="p">));</span>
    <span class="nf">setHSVmax</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">30</span><span class="p">,</span> <span class="m">256</span><span class="p">,</span> <span class="m">256</span><span class="p">));</span>

    <span class="c1">//BGR value for Red:
</span>    <span class="nf">setColor</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>

<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">"red"</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//TODO: use "calibration mode" to find HSV min
</span>    <span class="c1">//and HSV max values
</span>
    <span class="nf">setHSVmin</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
    <span class="nf">setHSVmax</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">19</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">));</span>

    <span class="c1">//BGR value for Red:
</span>    <span class="nf">setColor</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Scalar</span> <span class="p">(</span><span class="m">255</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>

<span class="p">}</span>
</code></pre></div> <p>The overall result is remarkably good and while it doesn’t look like it’s terribly accurate, that’s just due to the original designers implementation being tuned to a different set of colour thresholds.</p> <figure> <img src="https://handmap.github.io/images/posts/2017-03-14/opencv-unity-colour-tracking.png" alt="OpenCV Colour tracking in Unity3D" /> <figcaption>OpenCV Colour tracking in Unity3D</figcaption> </figure> <h2 id="what-i-learnt">What I learnt</h2> <hr /> <p>There are a couple key things I learnt from this short experiment, and I feel as though I really need to describe each of the points with a bit of detail:</p> <h3 id="position-in-frame">Position in frame</h3> <hr /> <p>I really like how the author of the library has created a class to handle the objects that it detects, which allowed him to store positional information about where in respect of the camera frame are the different objects.</p> <div class="language-csharp highlighter-rouge"><pre class="highlight"><code><span class="c1">/// Here are the ints that store the location reletive to the screen size
</span><span class="kt">int</span> <span class="n">xPos</span><span class="p">,</span> <span class="n">yPos</span><span class="p">;</span>

<span class="kt">string</span> <span class="n">type</span><span class="p">;</span>
<span class="n">Scalar</span> <span class="n">HSVmin</span><span class="p">,</span> <span class="n">HSVmax</span><span class="p">;</span>
<span class="n">Scalar</span> <span class="n">Color</span><span class="p">;</span>
</code></pre></div> <p>I plan to take this idea back to my Python and C++ code and see if I can come up with a less hackie solution for storing the points of interest that I am capturing</p> <h3 id="modularity">Modularity</h3> <hr /> <p>So far almost all my code have been reasonable size scripts with very little modularity. This was partially because of a lack of understand about Python classes and I really need to go back and clean up some of my implementations to be more portable.</p> <h3 id="processing-overhead-for-mobile">Processing overhead for mobile</h3> <hr /> <p>The overhead is a non-issue. It seems like most modern devices will easily be able to handle the processing overhead associated with computer vision. In the example I used a 50 object limit, and in some cases found it happily hitting that threshold without even stuttering</p> <figure> <img src="https://handmap.github.io/images/posts/2017-03-14/opencv-unity-colour-tracking-kitchen.png" alt="OpenCV Colour tracking in Kitchen" /> <figcaption>OpenCV Colour tracking in Kitchen</figcaption> </figure> <h2 id="references">References</h2> <hr /> <p>OpenCV for Unity store page - <a href="https://www.assetstore.unity3d.com/en/#!/content/21088">https://www.assetstore.unity3d.com/en/#!/content/21088</a></p> <br> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/opencv-colour-tracking-unity3d/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://handmap.github.io/video-3-progress-report/" class="pagination_pager" title="Video 3 - Progress Report ">previous</a> <a href="https://handmap.github.io/measuring-size-and-distance-opencv/" class="pagination_pager" title="Measuring size and distance with OpenCV ">next</a> </nav> </div> </div> <!-- JS --> <script src="https://handmap.github.io/assets/js/main.min.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-71336829-11', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script> <script type="text/javascript">require(["mojo/signup-forms/Loader"], function (L) { L.start({"baseUrl": "mc.us12.list-manage.com", "uuid": "02462dd1a88240d46fd5659d4", "lid": "317288b990"}) })</script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://github.com/HandMap/HandMap.github.io/blob/master/images/project.jpg) center center no-repeat;"> <a href="https://handmap.github.io" class="inactive" target="_blank" rel="nofollow external"> <span> Hand Map Project <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
