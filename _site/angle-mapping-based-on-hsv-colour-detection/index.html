<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Angle mapping w/ HSV detection &#8211; Hand Map</title> <meta name="description" content="Angle mapping based on HSV colour detection"> <meta name="keywords" content="hsv, opencv, angle detection"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Angle mapping w/ HSV detection"> <meta name="twitter:description" content="Angle mapping based on HSV colour detection"> <meta name="twitter:site" content="@nathangloverAUS"> <meta name="twitter:creator" content="@nathangloverAUS"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Angle mapping w/ HSV detection"> <meta property="og:description" content="Angle mapping based on HSV colour detection"> <meta property="og:url" content="https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/"> <meta property="og:site_name" content="Hand Map"> <meta property="og:image" content="https://handmap.github.io/images/halve.png"> <link rel="canonical" href="https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="https://handmap.github.io/feed.xml" title="Hand Map" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="https://handmap.github.io/favicon.png" /> <link rel="shortcut icon" href="https://handmap.github.io/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="https://handmap.github.io/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(https://handmap.github.io/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(https://handmap.github.io/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="https://handmap.github.io" class="logo"><img src="https://handmap.github.io/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Angle mapping w/ HSV detection </h1> <ul class="tags"> <li><a href="https://handmap.github.io/tags#hsv">hsv</a></li> <li><a href="https://handmap.github.io/tags#opencv">opencv</a></li> <li><a href="https://handmap.github.io/tags#angle detection">angle detection</a></li> </ul> <div class="section-line reverse"><a href="https://handmap.github.io/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">16 Oct 2016</div> <h2 id="introduction">Introduction</h2> <hr /> <p>Today I set to work on the Angle mapping process of my project. The goal for today was to have two objects detected then to draw a straight line between them and calculate the resulting angle.</p> <figure> <img src="https://handmap.github.io/images/posts/2016-10-16/opencv-angle-tracking.png" alt="Angle Tracking" /> <figcaption>Angle Tracking</figcaption> </figure> <p>The work done in this section will hopefully be very fundamental to the problem I’m looking to solve, so I tried to keep as much of it documented as possible.</p> <h2 id="final-code">Final Code</h2> <hr /> <p>I’d like to start this post by displaying the result and also linking the repo that houses the final code used for this solution:</p> <figure> <img src="https://handmap.github.io/images/posts/2016-10-16/opencv-live-angle-tracking.gif" alt="Angle Tracking" /> <figcaption>Live Angle Tracking</figcaption> </figure> <p>Repo: <a href="https://github.com/HandMap/openCVAngleTracking">https://github.com/HandMap/openCVAngleTracking</a></p> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cp">#include&lt;opencv2/core/core.hpp&gt;
#include&lt;opencv2/highgui/highgui.hpp&gt;
#include&lt;opencv2/imgproc/imgproc.hpp&gt;
</span>
<span class="cp">#include &lt;iostream&gt;
#include &lt;math.h&gt;
</span>
<span class="k">namespace</span> <span class="n">cv</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define PI 3.14159265
</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// open the default camera
</span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>  <span class="c1">// check if we succeeded
</span>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_HSV</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_Color1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_Color2</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Moments</span> <span class="n">moments_color1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Moments</span> <span class="n">moments_color2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">contours_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">contours_2</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">hierarchy_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">hierarchy_2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span> <span class="n">color_1</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span> <span class="n">color_2</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_frame</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">"Angles"</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">point1</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">point2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">center_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">center_2</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;;)</span>
    <span class="p">{</span>

        <span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">image_frame</span><span class="p">;</span> <span class="c1">// get a new frame from camera
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">image_frame</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>

        <span class="c1">// Generates HSV Matrix
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span>   <span class="c1">// Input image
</span>                     <span class="n">image_HSV</span><span class="p">,</span> <span class="c1">// output image in HSV
</span>                     <span class="n">CV_BGR2HSV</span><span class="p">);</span> <span class="c1">// constant refering to color space transformation
</span>
        <span class="c1">//filtering image for colors
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">inRange</span><span class="p">(</span><span class="n">image_HSV</span><span class="p">,</span> <span class="c1">//input image to be filtered
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="c1">//min thresshold value
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c1">// max threshold value
</span>                    <span class="n">image_Color1</span><span class="p">);</span> <span class="c1">//output image
</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">inRange</span><span class="p">(</span><span class="n">image_HSV</span><span class="p">,</span> <span class="c1">//input image to be filtered
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="c1">//min thresshold value
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c1">// max threshold value
</span>                    <span class="n">image_Color2</span><span class="p">);</span> <span class="c1">//output image
</span>
        <span class="c1">/// Find contours
</span>        <span class="n">findContours</span><span class="p">(</span> <span class="n">image_Color1</span><span class="p">,</span> <span class="c1">// input image
</span>                      <span class="n">contours_1</span><span class="p">,</span> <span class="c1">// vector to save contours
</span>                      <span class="n">hierarchy_1</span><span class="p">,</span>
                      <span class="n">CV_RETR_TREE</span><span class="p">,</span>
                      <span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="p">,</span>
                      <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>

        <span class="n">findContours</span><span class="p">(</span> <span class="n">image_Color2</span><span class="p">,</span> <span class="c1">// input image
</span>                      <span class="n">contours_2</span><span class="p">,</span> <span class="c1">// vector to save contours
</span>                      <span class="n">hierarchy_2</span><span class="p">,</span>
                      <span class="n">CV_RETR_TREE</span><span class="p">,</span>
                      <span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="p">,</span>
                      <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>


        <span class="c1">// Get the moments
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Moments</span><span class="o">&gt;</span> <span class="n">mu_1</span><span class="p">(</span><span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// initialize a vector of moments called mu, vector size the number of contours
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">(</span> <span class="n">contours_1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">false</span> <span class="p">);</span> <span class="p">}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Moments</span><span class="o">&gt;</span> <span class="n">mu_2</span><span class="p">(</span><span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// initialize a vector of moments called mu, vector size the number of contours
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">(</span> <span class="n">contours_2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">false</span> <span class="p">);</span> <span class="p">}</span>

        <span class="c1">///  Get the mass centers:
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">mc_1</span><span class="p">(</span><span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//vector to store all the center points of the contours.
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m10</span><span class="o">/</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">,</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m01</span><span class="o">/</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">);}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">mc_2</span><span class="p">(</span><span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//vector to store all the center points of the contours.
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mc_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m10</span><span class="o">/</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">,</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m01</span><span class="o">/</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">);}</span>


        <span class="c1">/// Draw contours
</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span>  <span class="p">(</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">){</span>
                <span class="n">center_1</span><span class="o">=</span><span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

                <span class="n">drawContours</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">contours_1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">color_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hierarchy_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">()</span> <span class="p">);</span>
                <span class="n">circle</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color_1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

                <span class="c1">//std::cout&lt;&lt; "red pen: " &lt;&lt;mc[i] &lt;&lt; '\n';
</span>            <span class="p">}</span>

        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span>  <span class="p">(</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">){</span>
                <span class="n">center_2</span><span class="o">=</span><span class="n">mc_2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">drawContours</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">contours_2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">color_2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hierarchy_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">()</span> <span class="p">);</span>
                <span class="n">circle</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">center_2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color_2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

                <span class="n">line</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span><span class="n">center_2</span><span class="p">,</span><span class="n">center_1</span><span class="p">,</span><span class="n">color_1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
                <span class="n">cv</span><span class="o">::</span><span class="n">putText</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">atan</span> <span class="p">(</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">PI</span><span class="p">)))</span> <span class="o">+</span> <span class="s">"Deg"</span><span class="p">),</span> <span class="p">(</span><span class="n">center_2</span> <span class="o">+</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="n">CV_FONT_HERSHEY_DUPLEX</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
                <span class="n">line</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span><span class="n">center_2</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image_frame</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="n">color_2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>


            <span class="p">}</span>

        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">"Point 1"</span> <span class="o">&lt;&lt;</span><span class="n">center_1</span> <span class="o">&lt;&lt;</span><span class="s">",  Point 2"</span><span class="o">&lt;&lt;</span> <span class="n">center_2</span>
                  <span class="o">&lt;&lt;</span> <span class="s">"  angle :"</span> <span class="o">&lt;&lt;</span><span class="n">atan</span> <span class="p">(</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">PI</span><span class="p">)</span>
                  <span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">"Angles"</span><span class="p">,</span> <span class="n">image_frame</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// the camera will be deinitialized automatically in VideoCapture destructoratan
</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <h2 id="code-breakdown">Code Breakdown</h2> <hr /> <p>Let’s break down each section of the code to get a better understanding of what’s going on.</p> <h3 id="imports">Imports</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cp">#include&lt;opencv2/core/core.hpp&gt;
#include&lt;opencv2/highgui/highgui.hpp&gt;
#include&lt;opencv2/imgproc/imgproc.hpp&gt;
</span>
<span class="cp">#include &lt;iostream&gt;
#include &lt;math.h&gt;
</span></code></pre></div> <p>The first thing we do is import all the necessary libraries. This includes the three main opencv2 c++ libraries and also iostream and maths.</p> <h3 id="namespace">Namespace</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="k">namespace</span> <span class="n">cv</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <p>One of the standard vector libraries used in this code needs to be defined in the main namespace.</p> <h3 id="define-pi">Define Pi</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cp">#define PI 3.14159265
</span></code></pre></div> <p>Later on in the code we use the ‘Pi’ constant; whilst I could use the one defined in the standard maths library, It is declared manually to give the reader the best idea about what is going on.</p> <h3 id="declare-variables">Declare variables</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">VideoCapture</span> <span class="n">cap</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// open the default camera
</span>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>  <span class="c1">// check if we succeeded
</span>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_HSV</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_Color1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_Color2</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Moments</span> <span class="n">moments_color1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Moments</span> <span class="n">moments_color2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">contours_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">contours_2</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">hierarchy_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">hierarchy_2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span> <span class="n">color_1</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span> <span class="n">color_2</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="p">);</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image_frame</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">"Angles"</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">point1</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">point2</span><span class="p">;</span>

    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">center_1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Point</span> <span class="n">center_2</span><span class="p">;</span>
</code></pre></div> <ol> <li>We begin the main loop and open the Video feed from the default camera.</li> <li>We declare a series of variables in preparation for use later on in the code. I’ll do my best to explain what each of the variable types are used for in a later section.</li> <li>We also open a new namedWindow with the title Angles.</li> </ol> <h3 id="begin-loop">Begin loop()</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>    <span class="k">for</span><span class="p">(;;)</span>
    <span class="p">{</span>
        <span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="n">image_frame</span><span class="p">;</span> <span class="c1">// get a new frame from camera
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">image_frame</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
</code></pre></div> <p>We start the main loop of the program by first getting a new frame image from the camera feed. If the frame isn’t empty we continue.</p> <h3 id="generate-hsv-matrix">Generate HSV Matrix</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span> <span class="c1">// Input image
</span>                     <span class="n">image_HSV</span><span class="p">,</span> <span class="c1">// output image in HSV
</span>                     <span class="n">CV_BGR2HSV</span><span class="p">);</span> <span class="c1">// constant refering to color space transformation
</span></code></pre></div> <p>We run the svtColor function over the image frame using the CV_BGR2HSV transformation method. The BGR2HSV transformation method takes a matrix in the native RGB order and converts it to its HSV equivalent. This is opposed to the standard RGB2HSV conversion that would require the input matrix be fed in in reverse order. example:</p> <p>(R, G, B) -&gt; (255, 0, 0) used with RGB2HSV would have to be stored as (0, 0, 255)</p> <p>however when we use BGR2HSV we can store our RGB values in the typical (255, 0, 0) manner.</p> <h3 id="hsv-inrange-thresholds">HSV inRange thresholds</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="c1">//filtering image for colors
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">inRange</span><span class="p">(</span><span class="n">image_HSV</span><span class="p">,</span> <span class="c1">//input image to be filtered
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="c1">//min thresshold value
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c1">// max threshold value
</span>                    <span class="n">image_Color1</span><span class="p">);</span> <span class="c1">//output image
</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">inRange</span><span class="p">(</span><span class="n">image_HSV</span><span class="p">,</span> <span class="c1">//input image to be filtered
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="c1">//min thresshold value
</span>                    <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="c1">// max threshold value
</span>                    <span class="n">image_Color2</span><span class="p">);</span> <span class="c1">//output image
</span></code></pre></div> <p>We generate the threshold maps for each of the two colours using the <code class="highlighter-rouge">cv::inRange()</code> method. This takes an input image, followed by two Scalar colours that represent the minimum and maximum thresholds, and finally the output image pointer to store our map in.</p> <h3 id="find-contours">Find contours</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="c1">/// Find contours
</span>        <span class="n">findContours</span><span class="p">(</span> <span class="n">image_Color1</span><span class="p">,</span> <span class="c1">// input image
</span>                      <span class="n">contours_1</span><span class="p">,</span> <span class="c1">// vector to save contours
</span>                      <span class="n">hierarchy_1</span><span class="p">,</span>
                      <span class="n">CV_RETR_TREE</span><span class="p">,</span>
                      <span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="p">,</span>
                      <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>

        <span class="n">findContours</span><span class="p">(</span> <span class="n">image_Color2</span><span class="p">,</span> <span class="c1">// input image
</span>                      <span class="n">contours_2</span><span class="p">,</span> <span class="c1">// vector to save contours
</span>                      <span class="n">hierarchy_2</span><span class="p">,</span>
                      <span class="n">CV_RETR_TREE</span><span class="p">,</span>
                      <span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="p">,</span>
                      <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div> <p>We use the findContours() method next and store the resulting contours in the contours_1, contours_2 vectors.</p> <h3 id="find-moments">Find moments</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="c1">// Get the moments
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Moments</span><span class="o">&gt;</span> <span class="n">mu_1</span><span class="p">(</span><span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// initialize a vector of moments called mu, vector size the number of contours
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">(</span> <span class="n">contours_1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">false</span> <span class="p">);</span> <span class="p">}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Moments</span><span class="o">&gt;</span> <span class="n">mu_2</span><span class="p">(</span><span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// initialize a vector of moments called mu, vector size the number of contours
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">moments</span><span class="p">(</span> <span class="n">contours_2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">false</span> <span class="p">);</span> <span class="p">}</span>
</code></pre></div> <p>We initialize two vector of moments for each colour point and move all our contour points into the moment vectors.</p> <h3 id="find-mass-centers">Find mass centers</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="c1">///  Get the mass centers:
</span>        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">mc_1</span><span class="p">(</span><span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//vector to store all the center points of the contours.
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m10</span><span class="o">/</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">,</span> <span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m01</span><span class="o">/</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">);}</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">mc_2</span><span class="p">(</span><span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="c1">//vector to store all the center points of the contours.
</span>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span> <span class="n">mc_2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m10</span><span class="o">/</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">,</span> <span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m01</span><span class="o">/</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span> <span class="p">);}</span>
</code></pre></div> <p>We find the mass centers of our contours that we plan to use use as a way to get the overall mass center of the largest coloured location</p> <h3 id="draw-contours">Draw contours</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">contours_1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span>  <span class="p">(</span><span class="n">mu_1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">){</span>
                <span class="n">center_1</span><span class="o">=</span><span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

                <span class="n">drawContours</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">contours_1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">color_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hierarchy_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">()</span> <span class="p">);</span>
                <span class="n">circle</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">mc_1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color_1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">contours_2</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span>  <span class="p">(</span><span class="n">mu_2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m00</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">){</span>
                <span class="n">center_2</span><span class="o">=</span><span class="n">mc_2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="n">drawContours</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">contours_2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">color_2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hierarchy_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">()</span> <span class="p">);</span>
                <span class="n">circle</span><span class="p">(</span> <span class="n">image_frame</span><span class="p">,</span> <span class="n">center_2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">color_2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>

                <span class="n">line</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span><span class="n">center_2</span><span class="p">,</span><span class="n">center_1</span><span class="p">,</span><span class="n">color_1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
                <span class="n">cv</span><span class="o">::</span><span class="n">putText</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">atan</span> <span class="p">(</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">PI</span><span class="p">)))</span> <span class="o">+</span> <span class="s">"Deg"</span><span class="p">),</span> <span class="p">(</span><span class="n">center_2</span> <span class="o">+</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span><span class="n">CV_FONT_HERSHEY_DUPLEX</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
                <span class="n">line</span><span class="p">(</span><span class="n">image_frame</span><span class="p">,</span><span class="n">center_2</span><span class="p">,</span><span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image_frame</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="n">color_2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div> <p>The final part of this code is to:</p> <ol> <li>Draw all the contours to the final image frame</li> <li>Draw a line from the right of the frame to the center point of the second coloured object</li> <li>Draw a line from the center of the first coloured object to the center of the second object</li> <li>Calculate the resulting angle and draw it to the left of the second object.</li> </ol> <h3 id="write-debug-to-terminal">Write debug to terminal</h3> <hr /> <div class="language-cpp highlighter-rouge"><pre class="highlight"><code>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span><span class="s">"Point 1"</span> <span class="o">&lt;&lt;</span><span class="n">center_1</span> <span class="o">&lt;&lt;</span><span class="s">",  Point 2"</span><span class="o">&lt;&lt;</span> <span class="n">center_2</span>
                  <span class="o">&lt;&lt;</span> <span class="s">"  angle :"</span> <span class="o">&lt;&lt;</span><span class="n">atan</span> <span class="p">(</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span><span class="p">(</span><span class="n">center_1</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">center_2</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="n">PI</span><span class="p">)</span>
                  <span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">"Angles"</span><span class="p">,</span> <span class="n">image_frame</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <p>Finally we write the debug values out to the console and deal with the program termination key capture.</p> <h2 id="variable-classes">Variable Classes</h2> <hr /> <p>Below is a brief overview of the Variable classes used in the code described above.</p> <h3 id="cvmat">cv::Mat</h3> <hr /> <p>N-dimensional dense array class. This structure will be used to store the matrix representation of the images.</p> <h3 id="cvmoments">cv::Moments</h3> <hr /> <p>The Definition of moments in image processing is borrowed from physics. Assume that each pixel in image has weight that is equal to its intensity. Then the point you defined is centroid (a.k.a. center of mass) of image.</p> <p>We will be using these Moments variables to store the computational results when finding our HSV detections.</p> <h3 id="cvpoint">cv::Point</h3> <hr /> <p>A point is simply a 2 dimensional x,y location in our image matrices</p> <h3 id="cvvec4i">cv::Vec4i</h3> <hr /> <p>The Vec class is commonly used to describe pixel types of multi-channel arrays.</p> <h3 id="cvscalar">cv::Scalar</h3> <hr /> <p>Being derived from Vec&lt;<em>Tp, 4&gt;, Scalar</em> and Scalar can be used just as typical 4-element vectors. In addition, they can be converted to/from CvScalar. The type Scalar is widely used in OpenCV to pass pixel values.</p> <p>We use the Scalar structures to store RGB and HSV colour values.</p> <h2 id="conclusion">Conclusion</h2> <hr /> <p>At this point in time I’m at a good place with this project and am ready to move onto working with the two sensor box colours on a hand model.</p> <p>I’ll be tackling this task ASAP.</p> <h2 id="references">References</h2> <hr /> <p>Understanding Moments in OpenCV - <a href="http://stackoverflow.com/questions/22470902/understanding-moments-function-in-opencv">http://stackoverflow.com/questions/22470902/understanding-moments-function-in-opencv</a></p> <p>Basic OpenCV Structures - <a href="http://docs.opencv.org/2.4/modules/core/doc/basic_structures.html">http://docs.opencv.org/2.4/modules/core/doc/basic_structures.html</a></p> <p>Scalar - <a href="http://docs.opencv.org/java/2.4.9/org/opencv/core/Scalar.html">http://docs.opencv.org/java/2.4.9/org/opencv/core/Scalar.html</a></p> <p>Measuring angles in OpenCV - <a href="http://www.pdnotebook.com/2012/07/measuring-angles-in-opencv/">http://www.pdnotebook.com/2012/07/measuring-angles-in-opencv/</a></p> <p>measuring angle in opencv c++ - <a href="https://sites.google.com/site/javiereperez1992/projects">https://sites.google.com/site/javiereperez1992/projects</a></p> <p>OpenCV Changing Colorspaces - <a href="http://docs.opencv.org/trunk/df/d9d/tutorial_py_colorspaces.html">http://docs.opencv.org/trunk/df/d9d/tutorial_py_colorspaces.html</a></p> <br> <a href="https://twitter.com/intent/tweet?text=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=https://handmap.github.io/angle-mapping-based-on-hsv-colour-detection/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="https://handmap.github.io/video-2-project-update/" class="pagination_pager" title="Video 2 - Project Update ">previous</a> <a href="#" class="pagination_pager disabled">next</a> </nav> </div> </div> <!-- JS --> <script src="https://handmap.github.io/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://github.com/HandMap/HandMap.github.io/blob/master/images/project.jpg) center center no-repeat;"> <a href="https://handmap.github.io" class="inactive" target="_blank" rel="nofollow external"> <span> Hand Map Project <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
